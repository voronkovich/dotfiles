#!/usr/bin/env sh

get_version() {
    if [ -f "${PWD}/.ansible-version" ]; then
        cat "${PWD}/.ansible-version"
    else
        echo "${ANSIBLE_VERSION:-alpine}"
    fi
}

readonly tag="$(get_version)"
readonly ssh_key="${ANSIBLE_SSH_KEY:-id_rsa}"

docker run --rm -it \
    -e ANSIBLE_HOST_KEY_CHECKING=False \
    -v "$(pwd):/ansible" \
    -v "${HOME}/.ssh/${ssh_key}:/root/.ssh/${ssh_key}:ro" \
    "willhallonline/ansible:${tag}" \
    "$@"
